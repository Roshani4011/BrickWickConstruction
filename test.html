<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Construction Cost Estimator</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /*=========================================
 * GLOBAL STYLES & RESETS
 *=========================================*/
:root {
    --primary-color: #007bff;     /* Blue for buttons/highlights */
    --secondary-color: #28a745;   /* Green for success/cost */
    --error-color: #dc3545;       /* Red for errors */
    --background-light: #f8f9fa;  /* Light gray background */
    --border-color: #ced4da;      /* Light border for inputs */
    --text-color: #343a40;        /* Dark text */
    --box-shadow-light: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
}

* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Arial', sans-serif;
    line-height: 1.6;
    color: var(--text-color);
    background-color: var(--background-light);
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 15px;
}

.section {
    padding: 40px 0;
    text-align: center;
}

.section-title {
    margin-bottom: 30px;
    font-size: 2rem;
    color: var(--primary-color);
    text-transform: uppercase;
}

/* Scrollbar lock when modal is open (for JavaScript) */
.modal-open {
    overflow: hidden;
}

/*=========================================
 * ESTIMATOR LAYOUT (MAIN PAGE SECTION)
 *=========================================*/
.estimator-layout {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    justify-content: space-between;
    background: #fff;
    border-radius: 8px;
    box-shadow: var(--box-shadow-light);
    overflow: hidden;
    margin-top: 20px;
}

.estimator-image {
    flex: 1 1 40%;
    min-width: 300px;
    max-height: 400px;
    overflow: hidden;
}

.estimator-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
}

.estimator-info {
    flex: 1 1 50%;
    padding: 30px;
    text-align: left;
}

.estimator-info p {
    font-size: 1.1rem;
    margin-bottom: 15px;
}

.estimator-info .highlight {
    color: var(--primary-color);
    font-weight: bold;
}

.steps-list {
    list-style-type: decimal;
    margin-left: 20px;
    margin-bottom: 25px;
    padding-left: 0;
    color: #6c757d;
}

.steps-list li {
    margin-bottom: 5px;
}

.subtext {
    font-size: 0.9rem;
    color: #6c757d;
    margin-top: 20px;
}

/*=========================================
 * BUTTONS
 *=========================================*/
#open-estimator-btn,
#calculate-estimate-btn,
#closeModal {
    background-color: var(--primary-color);
    color: white;
    border: none;
    padding: 12px 25px;
    border-radius: 4px;
    cursor: pointer;
    font-size: 1rem;
    font-weight: bold;
    transition: background-color 0.2s, transform 0.1s;
    text-transform: uppercase;
}

#open-estimator-btn:hover,
#calculate-estimate-btn:hover,
#closeModal:hover {
    background-color: #0056b3;
    transform: translateY(-1px);
}

#calculate-estimate-btn {
    width: 100%;
    margin-top: 20px;
    background-color: var(--secondary-color);
}

#calculate-estimate-btn:hover {
    background-color: #1e7e34;
}

#calculate-estimate-btn:disabled {
    background-color: #6c757d;
    cursor: not-allowed;
}

.close-btn {
    background: none;
    border: none;
    font-size: 2rem;
    cursor: pointer;
    color: #6c757d;
}

/*=========================================
 * POPUP / MODAL OVERLAY
 *=========================================*/
.popup-overlay {
    /* Critical for modal display */
    display: none; 
    position: fixed;
    z-index: 1000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.6); /* Dark semi-transparent background */
    align-items: center;
    justify-content: center;
    overflow-y: auto;
}

.popup-content {
    background-color: #fff;
    margin: 5% auto; 
    padding: 25px;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 700px;
    position: relative;
}

.popup-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #eee;
    padding-bottom: 10px;
    margin-bottom: 15px;
}

.popup-header h3 {
    color: var(--primary-color);
}

/*=========================================
 * FORM STYLES
 *=========================================*/
.form-row {
    display: flex;
    gap: 20px;
    margin-bottom: 15px;
}

.form-group {
    flex: 1;
    display: flex;
    flex-direction: column;
    position: relative; /* For error message positioning */
}

.form-group label {
    margin-bottom: 5px;
    font-weight: 600;
    font-size: 0.95rem;
}

.form-group input[type="text"],
.form-group input[type="number"],
.form-group input[type="email"],
.form-group input[type="tel"],
.form-group select {
    width: 100%;
    padding: 10px;
    border: 1px solid var(--border-color);
    border-radius: 4px;
    font-size: 1rem;
    transition: border-color 0.2s, box-shadow 0.2s;
}

.form-group input:focus,
.form-group select:focus {
    border-color: var(--primary-color);
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
    outline: none;
}

/*=========================================
 * VALIDATION/ERROR STYLES
 *=========================================*/
.input-error {
    border-color: var(--error-color) !important;
}

.input-error:focus {
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.error-message {
    color: var(--error-color);
    font-size: 0.8rem;
    margin-top: 5px;
    text-align: left;
    font-weight: 500;
}

/*=========================================
 * THANK YOU MODAL (Result Display)
 *=========================================*/
.thank-you-box {
    background-color: #fff;
    padding: 40px;
    text-align: center;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    width: 90%;
    max-width: 500px;
}

.thank-you-box h2 {
    color: var(--secondary-color);
    margin-bottom: 15px;
    font-size: 2.5rem;
}

#cost-result {
    margin: 25px 0;
    padding: 15px;
    border: 2px dashed var(--secondary-color);
    border-radius: 4px;
    font-size: 1.2rem;
    font-weight: 600;
    background-color: #e2f0d9; /* Light green background */
}

/*=========================================
 * MEDIA QUERIES (Responsiveness)
 *=========================================*/

@media (max-width: 768px) {
    .estimator-layout {
        flex-direction: column;
    }

    .estimator-image {
        min-width: auto;
        width: 100%;
        order: -1; /* Image appears first on mobile */
    }

    .estimator-info {
        padding: 20px;
        text-align: center;
        width: 100%;
    }
    
    .steps-list {
        text-align: left;
        margin: 15px auto 20px;
        max-width: 300px; /* Constrain list width for better look */
    }
    
    .popup-content {
        margin: 10% 15px;
        max-height: 90vh;
    }

    .form-row {
        flex-direction: column;
        gap: 0;
    }

    .form-group {
        margin-bottom: 15px;
    }
}
    </style>
</head>
<body>

    <main>
        <section id="cost-estimator" class="section">
            <div class="container">
                <h2 class="section-title">Cost Estimator</h2>
                <div class="estimator-layout">
                    <div class="estimator-image">
                        <img src="pictures/estimator-house.jpeg" alt="Construction Estimate">
                    </div>
                    <div class="estimator-info">
                        <p>Get an <span class="highlight">instant cost estimate</span> for your dream construction project in just a few clicks!</p>
                        <p>Get an estimate for your project by clicking the button below:</p>
                        <ol class="steps-list">
                            <li>Enter your project details</li>
                            <li>Choose your construction package</li>
                            <li>Provide your contact information</li>
                            <li>Get your personalized estimate instantly</li>
                        </ol>
                        <p class="subtext">Our advanced calculator provides personalized pricing based on your specific requirements.</p>
                        <button id="open-estimator-btn">Calculate Your Project Cost</button>
                    </div>
                </div>

                <div id="estimator-popup" class="popup-overlay">
                    <div class="popup-content">
                        <div class="popup-header">
                            <h3>Cost Estimator Form</h3>
                            <button id="close-popup-btn" class="close-btn">&times;</button>
                        </div>
                        <p>Get an estimate for your project by filling out the form below:</p>
                        
                        <form id="cost-estimator-form" method="post">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cost-estimator-plot-size">Plot Size (sq ft)</label>
                                    <input type="number" id="cost-estimator-plot-size" name="plot_size" placeholder="e.g. 1000" required>
                                </div>
                                <div class="form-group">
                                    <label for="cost-estimator-plot-location">Location</label>
                                    <select id="cost-estimator-plot-location" name="plot_location" required>
                                        <option value="">Select Location</option>
                                        <option value="urban">Urban</option>
                                        <option value="suburban">Suburban</option>
                                        <option value="rural">Rural</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cost-estimator-package-select">Construction Package</label>
                                    <select id="cost-estimator-package-select" name="package" required>
                                        <option value="">Select Package</option>
                                        <option value="1099">Basic (Rs.1099/-)</option>
                                        <option value="1499">Standard (Rs.1499/-)</option>
                                        <option value="1799">Premium (Rs.1799/-)</option>
                                        <option value="2099">Luxury (Rs.2099/-)</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="cost-estimator-floors">Number of Floors</label>
                                    <select id="cost-estimator-floors" name="floors" required>
                                        <option value="">Select Floors</option>
                                        <option value="1">Ground</option>
                                        <option value="2">Ground + 1</option>
                                        <option value="3">Ground + 2</option>
                                        <option value="4">Ground + 3</option>
                                        <option value="5">Ground + 4</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cost-estimator-name">Full Name</label>
                                    <input type="text" id="cost-estimator-name" name="name" placeholder="Your Name" required>
                                </div>
                                <div class="form-group">
                                    <label for="cost-estimator-email">Email Address</label>
                                    <input type="email" id="cost-estimator-email" name="email" placeholder="Your Email" required>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cost-estimator-phone">Phone Number</label>
                                    <input type="tel" id="cost-estimator-phone" name="phone" placeholder="Your Phone Number" required>
                                </div>
                                <div class="form-group">
                                    <label for="cost-estimator-lift">Lift</label>
                                    <select id="cost-estimator-lift" name="lift" required>
                                        <option value="">Select</option>
                                        <option value="yes">Yes</option>
                                        <option value="no">No</option>
                                    </select>
                                </div>
                            </div>
                            <button type="submit" id="calculate-estimate-btn">Calculate Estimate</button>
                        </form>
                    </div>
                </div>

                <div id="thankYouModal1" class="popup-overlay">
                    <div class="thank-you-box">
                        <h2>Thank you!</h2>
                        <p id="modal-message">Your personalized project estimate is below:</p>
                        <div id="cost-result"></div>
                        <button id="closeModal">Close</button>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script>
        //=========================================
// COST ESTIMATOR - FINAL SECURE JAVASCRIPT
//=========================================
(function(){
    'use strict';

    /*** Configuration */
    const CONFIG = {
        API_ENDPOINT: 'store_estimation.php',
        PACKAGE_RATES: {'1099': 1099,'1499': 1499,'1799': 1799,'2099': 2099},
        MAX_PLOT_SIZE: 100000,
        MIN_PLOT_SIZE: 100,
        TIMEOUT: 30000 // 30 seconds
    };

    /*** DOM Element Cache */
    const elements = {};

    function cacheElements() {
        elements.openBtn = document.getElementById('open-estimator-btn');
        elements.closePopupBtn = document.getElementById('close-popup-btn');
        elements.closeModalBtn = document.getElementById('closeModal');
        elements.popup = document.getElementById('estimator-popup');
        elements.thankYouModal = document.getElementById('thankYouModal1');
        elements.form = document.getElementById('cost-estimator-form');
        elements.costResult = document.getElementById('cost-result');
        elements.submitBtn = document.getElementById('calculate-estimate-btn');
    }

    /* --- UTILITY FUNCTIONS --- */
    function openEstimatorPopup() {
        if (elements.popup) {
            elements.popup.style.display = 'flex'; 
            document.body.classList.add('modal-open');
        }
    }
    
    function closeEstimatorPopup() {
        if (elements.popup) {
            elements.popup.style.display = 'none';
            document.body.classList.remove('modal-open');
        }
        if (elements.form) {
            elements.form.reset();
            clearValidationErrors(elements.form);
        }
    }

    function clearValidationErrors(form) {
        form.querySelectorAll('.error-message').forEach(msg => msg.remove());
        form.querySelectorAll('.input-error').forEach(input => input.classList.remove('input-error'));
    }

    function showFieldError(fieldId, message) {
        const field = document.getElementById(fieldId);
        if (!field) return;

        field.parentElement.querySelector('.error-message')?.remove();
        field.classList.add('input-error');
        
        const errorDiv = document.createElement('div');
        errorDiv.className = 'error-message';
        errorDiv.textContent = message;
        field.parentElement.appendChild(errorDiv);
    }
    
    function calculateEstimate(plotSize, packageRate, floors) {
        return Math.round(plotSize * packageRate * floors);
    }

    function setLoadingState(isLoading) {
        if (elements.submitBtn) {
            elements.submitBtn.disabled = isLoading;
            elements.submitBtn.textContent = isLoading ? 'Calculating...' : 'Calculate Estimate';
        }
        elements.form?.querySelectorAll('input, select').forEach(input => input.disabled = isLoading);
    }

    /* --- VALIDATION & SUBMISSION LOGIC --- */
    function validateFormData(formData) {
        const errors = [];
        const plotSize = parseFloat(formData.get('plot_size'));
        const packageRate = formData.get('package'); 
        const floors = parseInt(formData.get('floors'));
        const email = formData.get('email')?.trim();
        const phone = formData.get('phone')?.trim();

        if (isNaN(plotSize) || plotSize < CONFIG.MIN_PLOT_SIZE || plotSize > CONFIG.MAX_PLOT_SIZE) { errors.push({ field: 'cost-estimator-plot-size', message: `Plot size must be between ${CONFIG.MIN_PLOT_SIZE} and ${CONFIG.MAX_PLOT_SIZE} sq ft.` }); }
        if (!CONFIG.PACKAGE_RATES[packageRate]) { errors.push({ field: 'cost-estimator-package-select', message: 'Please select a valid package.' }); }
        if (isNaN(floors) || floors < 1 || floors > 5) { errors.push({ field: 'cost-estimator-floors', message: 'Invalid number of floors selected.' }); }
        if (!formData.get('name')?.trim() || formData.get('name').length < 2) { errors.push({ field: 'cost-estimator-name', message: 'Enter your full name (min 2 chars).' }); }
        if (!email || !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { errors.push({ field: 'cost-estimator-email', message: 'Enter a valid email address.' }); }
        if (!phone || !/^[6-9]\d{9}$/.test(phone)) { errors.push({ field: 'cost-estimator-phone', message: 'Enter a valid 10-digit mobile number.' }); }
        if (!formData.get('plot_location')) { errors.push({ field: 'cost-estimator-plot-location', message: 'Please select a location.' }); }
        if (!formData.get('lift')) { errors.push({ field: 'cost-estimator-lift', message: 'Please select the lift option.' }); }

        return {
            isValid: errors.length === 0,
            errors: errors,
            data: { plotSize, packageRate: parseFloat(packageRate), floors }
        };
    }

    async function submitEstimate(event) {
        event.preventDefault();
        const form = event.target;
        const formData = new FormData(form);
        clearValidationErrors(form);

        const validation = validateFormData(formData);
        if (!validation.isValid) {
            validation.errors.forEach(error => showFieldError(error.field, error.message));
            document.getElementById(validation.errors[0].field)?.focus();
            return;
        }

        const { plotSize, packageRate, floors } = validation.data;
        const totalCost = calculateEstimate(plotSize, packageRate, floors);
        formData.append('estimated_total', totalCost); // CRITICAL: Send cost to server

        setLoadingState(true);

        const controller = new AbortController();
        const timeoutId = setTimeout(() => controller.abort(), CONFIG.TIMEOUT);
        
        try {
            const response = await fetch(CONFIG.API_ENDPOINT, {
                method: 'POST',
                body: formData,
                signal: controller.signal,
                headers: { 'X-Requested-With': 'XMLHttpRequest' }
            });
            clearTimeout(timeoutId);

            if (!response.ok) {
                throw new Error(`Server error: ${response.status} - ${response.statusText}`);
            }

            const result = await response.json();

            if (result.status === 'success') {
                const formattedCost = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', minimumFractionDigits: 0 }).format(totalCost);
                elements.costResult.innerHTML = `Your Estimated Project Cost: <span style="font-size:1.5rem;font-weight:bold;color:#388e3c;">${formattedCost}</span>`;
                
                closeEstimatorPopup();
                elements.thankYouModal.style.display = 'flex'; 

            } else {
                throw new Error(result.message || 'Failed to save estimate due to server logic error.');
            }

        } catch (error) {
            console.error('Submission error:', error);
            alert(error.message || 'A network error occurred. Please try again.');
        } finally {
            setLoadingState(false);
        }
    }


    /* --- INITIALIZATION --- */
    function init() {
        cacheElements();
        
        // Attach Event Listeners
        if (elements.openBtn) { elements.openBtn.addEventListener('click', openEstimatorPopup); }
        if (elements.closePopupBtn) { elements.closePopupBtn.addEventListener('click', closeEstimatorPopup); }
        if (elements.closeModalBtn) { elements.closeModalBtn.addEventListener('click', () => elements.thankYouModal.style.display = 'none'); }
        if (elements.form) { elements.form.addEventListener('submit', submitEstimate); }

        // Accessibility/UX handlers
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                if (elements.popup?.style.display === 'flex') closeEstimatorPopup();
                else if (elements.thankYouModal?.style.display === 'flex') elements.thankYouModal.style.display = 'none';
            }
        });
        
        console.log('Cost Estimator initialized successfully.');
    }

    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
    } else {
        init();
    }
})();
    </script>
</body>
</html>